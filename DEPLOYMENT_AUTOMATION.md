# Deployment Automation Configuration

## ğŸš€ **What Happens on Every Push to Main Branch:**

### **1. Automatic Database Migrations**
- âœ… Waits for database connection
- âœ… Runs `python manage.py migrate --noinput`
- âœ… Creates/updates all database tables

### **2. Initial Data Seeding**
- âœ… Creates user roles/groups (Admin, Professional, Patient)
- âœ… Sets up permissions for each role
- âœ… Seeds any required initial data

### **3. Admin User Creation**
- âœ… Creates admin superuser automatically
- âœ… Uses environment variables for credentials
- âœ… Skips if admin already exists

### **4. Static Files Collection**
- âœ… Collects all static files for production
- âœ… Optimizes for web serving

## ğŸ”§ **Configuration Files Created:**

### **Deployment Script** (`backend/scripts/deploy.sh`)
- Orchestrates the entire deployment process
- Handles database setup, migrations, and server startup
- Includes error handling and logging

### **Django Management Commands:**

1. **`create_admin_user.py`**
   - Creates admin user with configurable credentials
   - Prevents duplicate admin creation
   - Uses environment variables for security

2. **`wait_for_db.py`**
   - Waits for database to be available
   - Prevents migration failures on startup
   - Configurable timeout

3. **`seed_initial_data.py`**
   - Creates user roles and permissions
   - Sets up initial application data
   - Idempotent (safe to run multiple times)

## ğŸ” **Environment Variables (Render Dashboard):**

```bash
# Database (auto-configured by Render)
DATABASE_URL=postgresql://...

# Admin User Credentials
ADMIN_USERNAME=admin
ADMIN_EMAIL=admin@edumindsolutions.com
ADMIN_PASSWORD=[auto-generated by Render]

# Application Settings
SECRET_KEY=[auto-generated by Render]
DEBUG=False
ALLOWED_HOSTS=edumindsolutions.onrender.com
CORS_ALLOWED_ORIGINS=https://edu-mind-solutions.vercel.app
```

## ğŸ“‹ **Default Admin User:**

- **Username**: `admin` (configurable via `ADMIN_USERNAME`)
- **Email**: `admin@edumindsolutions.com` (configurable via `ADMIN_EMAIL`)
- **Password**: Auto-generated by Render (check environment variables)
- **Role**: Superuser with all permissions

## ğŸ¯ **User Roles Created:**

### **Admin**
- Full system access
- User management
- All CRUD operations

### **Professional**
- Healthcare provider access
- Assessment management
- Patient data access

### **Patient**
- Limited access
- Own profile management
- Assessment participation

## ğŸš€ **Deployment Flow:**

```mermaid
graph TD
    A[Push to Main] --> B[GitHub Actions]
    B --> C[Trigger Render Deployment]
    C --> D[Build Docker Image]
    D --> E[Wait for Database]
    E --> F[Run Migrations]
    F --> G[Seed Initial Data]
    G --> H[Create Admin User]
    H --> I[Collect Static Files]
    I --> J[Start Gunicorn Server]
    J --> K[Health Check]
    K --> L[Deployment Complete]
```

## ğŸ” **Monitoring & Logs:**

### **Check Deployment Status:**
1. Go to Render Dashboard
2. Select your service
3. Check "Logs" tab for deployment progress

### **Expected Log Output:**
```
ğŸš€ Starting deployment script...
â³ Waiting for database connection...
âœ… Database connection established!
ğŸ“Š Running database migrations...
ğŸŒ± Seeding initial data...
âœ… Created group: Admin
âœ… Created group: Professional  
âœ… Created group: Patient
ğŸ‘¤ Creating admin user...
âœ… Successfully created admin user: admin
ğŸ“ Collecting static files...
ğŸš€ Starting Gunicorn server...
```

## ğŸ› ï¸ **Troubleshooting:**

### **Common Issues:**

1. **Migration Failures**
   - Check database connection
   - Verify DATABASE_URL environment variable
   - Check migration files for conflicts

2. **Admin User Creation Fails**
   - Check if user already exists
   - Verify ADMIN_* environment variables
   - Check user model configuration

3. **Static Files Issues**
   - Verify STATIC_ROOT setting
   - Check file permissions
   - Ensure collectstatic runs without errors

### **Manual Commands (if needed):**

```bash
# Connect to Render shell
render shell

# Run specific commands
python manage.py migrate
python manage.py create_admin_user
python manage.py seed_initial_data
python manage.py collectstatic --noinput
```

## âœ… **Verification Steps:**

After deployment:

1. **Check API Health**: `https://edumindsolutions.onrender.com/health/`
2. **Test Admin Login**: Use admin credentials from environment variables
3. **Verify Database**: Check that tables and data exist
4. **Test Frontend**: Ensure frontend can connect to backend API

## ğŸ”„ **Future Deployments:**

Every push to main branch will:
- âœ… Run migrations (safe, only applies new ones)
- âœ… Skip admin creation (if already exists)
- âœ… Update static files
- âœ… Restart server with zero downtime

**Your deployment is now fully automated!** ğŸ‰
